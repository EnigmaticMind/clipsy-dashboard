# Clipsy Dashboard

A Chrome extension for managing Etsy listings with CSV import/export. Download your listings, edit them locally in Excel or any spreadsheet editor, and upload changes back to Etsy with a preview of what will be modified.

## Features

- üîê **OAuth Authentication** - Secure authentication with Etsy using PKCE flow
- üì• **Download Listings** - Export all your Etsy listings to CSV format
- üì§ **Upload with Preview** - Upload edited CSV files and preview changes before applying
- ‚úèÔ∏è **Bulk Editing** - Edit listings locally in Excel or any spreadsheet editor
- üéØ **Selective Updates** - Choose which changes to apply from the preview
- üîÑ **Variation Support** - Full support for listings with variations
- üóëÔ∏è **Delete Support** - Delete listings or variations by setting SKU to "DELETE"

## Prerequisites

- Node.js 18+ and npm
- Chrome browser (or Chromium-based browser)
- Etsy API credentials (Client ID from [Etsy Developers](https://www.etsy.com/developers))

## Installation

1. **Clone the repository:**

```bash
git clone <repository-url>
cd clipsy-dashboard
```

2. **Install dependencies:**

```bash
npm install
```

3. **Configure Etsy Client ID (if needed):**

The Etsy Client ID is already hardcoded in `src/services/oauth.ts` and `src/services/etsyApi.ts`. If you need to use a different Client ID, replace the value in both files.

You can get your Etsy Client ID from:

- Go to [Etsy Developers](https://www.etsy.com/developers)
- Create a new app or use an existing one
- Copy the Client ID (also called "Keystring")

**Note:** The Client ID is public and safe to include in the extension code. For Chrome extensions, the redirect URL is automatically generated by Chrome using `chrome.identity.getRedirectURL()`.

## Building the Extension

Build the Chrome extension:

```bash
npm run build:extension
```

This will create a `dist/` folder with all the extension files ready to load.

## Loading the Extension in Chrome

1. Open Chrome and navigate to `chrome://extensions/`
2. Enable **"Developer mode"** (toggle in the top right corner)
3. Click **"Load unpacked"**
4. Select the `dist/` folder from this project
5. The Clipsy extension icon should appear in your Chrome toolbar

### Getting a Stable Extension ID

To get a stable extension ID (so your redirect URL doesn't change), you need to add a public key to the manifest. The extension ID `cgfilfbjdodfaeapagaomgdjdlocpbbg` is derived from a specific public key.

**If you already have an extension with ID `cgfilfbjdodfaeapagaomgdjdlocpbbg` loaded in Chrome:**

1. **Pack that extension to get the public key**:

   - Go to `chrome://extensions/`
   - Find your extension with ID `cgfilfbjdodfaeapagaomgdjdlocpbbg`
   - Click "Pack extension"
   - Select the extension's folder (or use the extension ID)
   - Chrome will create a `.crx` file

2. **Extract the public key from the packed extension**:

   - Unzip the `.crx` file (it's just a zip file - rename to `.zip` if needed)
   - Open the `manifest.json` inside
   - Copy the `"key"` field value (this is your public key - a long base64 string)

3. **Add the public key to your manifest**:
   - Open `src/manifest.ts`
   - Replace `undefined` with your public key:
     ```typescript
     const EXTENSION_PUBLIC_KEY: string | undefined =
       "MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA...";
     ```

**If you have a `.pem` file that generates this extension ID:**

1. Run the extraction script:
   ```bash
   ./extract-public-key.sh key.pem
   ```
2. Copy the public key shown and add it to `src/manifest.ts` as above

3. **Rebuild the extension**:

   ```bash
   npm run build:extension
   ```

4. **Load the extension** - it will now use extension ID `cgfilfbjdodfaeapagaomgdjdlocpbbg` every time

**Important:**

- The redirect URL will be: `https://<extension-id>.chromiumapp.org/auth`
- Once you have a stable ID, register this URL in your Etsy app settings
- Keep your `.pem` file (private key) secure and don't commit it to version control

**Alternative (without key):**
If you don't add a key, the extension ID will change each time you reload it. You can still find your extension ID:

- Go to `chrome://extensions/`
- Find your extension and copy the ID (long string under the extension name)
- Use this ID to construct your redirect URL: `https://<extension-id>.chromiumapp.org/auth`
- Note: You'll need to update the redirect URL in Etsy each time the ID changes

## Using the Extension

### First Time Setup

1. Click the Clipsy extension icon in your Chrome toolbar
2. The dashboard will open in a new tab
3. Click **"Authenticate with Etsy"** to connect your Etsy account
4. You'll be redirected to Etsy to authorize the app
5. After authorization, you'll be redirected back to the dashboard

### Downloading Listings

1. Select the listing status you want to download:
   - All Listings
   - Active
   - Draft
   - Inactive
   - Sold Out
   - Expired
2. Click **"Download Listings"**
3. A CSV file will be downloaded with all your listings

### Editing Listings

1. Open the downloaded CSV file in Excel, Google Sheets, or any spreadsheet editor
2. Edit the fields you want to change:
   - **Title** - Listing title
   - **Description** - Listing description
   - **SKU** - Stock keeping unit (or "DELETE" to delete a listing)
   - **Status** - Listing status (active, draft, inactive, etc.)
   - **Quantity** - Stock quantity
   - **Tags** - Comma-separated tags
   - **Price** - Listing price
   - **Currency Code** - Currency (e.g., USD)
   - **Variation fields** - For listings with variations
3. Save the CSV file

### Uploading Changes

1. Click **"Upload CSV"** in the dashboard
2. Select your edited CSV file
3. Review the preview of changes:
   - See what will be created, updated, or deleted
   - View before/after comparisons for each field
   - Accept or decline individual changes
4. Click **"Apply Changes"** to apply the accepted changes
5. Changes will be applied to your Etsy shop

## Development

### Running in Development Mode

For development with hot reload:

```bash
npm run dev
```

**Note:** The extension will need to be reloaded in Chrome after making changes during development.

### Project Structure

```
clipsy-dashboard/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ background.ts          # Extension background service worker
‚îÇ   ‚îú‚îÄ‚îÄ manifest.ts           # Extension manifest configuration
‚îÇ   ‚îú‚îÄ‚îÄ main.tsx              # React app entry point
‚îÇ   ‚îú‚îÄ‚îÄ pages/                # Page components
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ LandingPage.tsx   # Main dashboard page
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ AuthPage.tsx      # OAuth redirect handler
‚îÇ   ‚îú‚îÄ‚îÄ components/            # React components
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ UploadPreview.tsx # Preview modal for changes
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ LoadingSpinner.tsx # Loading indicator
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ EtsyTrademark.tsx # Etsy trademark notice
‚îÇ   ‚îî‚îÄ‚îÄ services/              # Business logic services
‚îÇ       ‚îú‚îÄ‚îÄ oauth.ts          # OAuth authentication
‚îÇ       ‚îú‚îÄ‚îÄ etsyApi.ts        # Etsy API client
‚îÇ       ‚îú‚îÄ‚îÄ csvService.ts     # CSV generation
‚îÇ       ‚îú‚îÄ‚îÄ uploadService.ts  # CSV parsing
‚îÇ       ‚îú‚îÄ‚îÄ previewService.ts # Change detection & preview
‚îÇ       ‚îú‚îÄ‚îÄ applyService.ts   # Apply changes to Etsy
‚îÇ       ‚îî‚îÄ‚îÄ listingOperations.ts # Listing CRUD operations
‚îú‚îÄ‚îÄ public/                    # Static assets
‚îú‚îÄ‚îÄ dist/                      # Built extension (after build)
‚îú‚îÄ‚îÄ dashboard.html             # Extension dashboard page
‚îú‚îÄ‚îÄ vite.config.ts             # Vite configuration
‚îî‚îÄ‚îÄ package.json               # Dependencies and scripts
```

### Available Scripts

- `npm run dev` - Start development server
- `npm run build` - Build for production (web app)
- `npm run build:extension` - Build Chrome extension
- `npm run lint` - Run ESLint
- `npm run preview` - Preview production build

## Permissions

The extension requires the following permissions:

- `storage` - To store authentication tokens
- `tabs` - To open the dashboard in a new tab
- `identity` - For OAuth authentication flow
- `host_permissions` - To access Etsy API endpoints

## Troubleshooting

### Extension won't load

- Make sure you're loading the `dist/` folder, not the root directory
- Check that Developer mode is enabled in Chrome
- Look for errors in `chrome://extensions/` (click "Errors" button)

### Authentication fails

- Verify your Etsy Client ID is set correctly in `src/services/oauth.ts` and `src/services/etsyApi.ts`
- Make sure the Client ID is from an active Etsy app
- Check that the app has the required scopes: `listings_r`, `listings_w`, `shops_r`

### CSV upload fails

- Ensure the CSV file was downloaded from the extension (correct format)
- Check that Listing ID and Product ID columns are preserved
- Verify the CSV has the correct number of columns (23 columns)

### Changes not applying

- Check the browser console for errors (F12 ‚Üí Console)
- Verify you accepted the changes in the preview modal
- Make sure you have permission to edit the listings

## Security Notes

- **Client ID**: The Etsy Client ID is public and safe to include in the extension
- **Tokens**: Access tokens are stored locally in Chrome's storage
- **No Backend**: All operations are performed client-side, no data is sent to external servers except Etsy's API

## CSV Format

The CSV file contains the following columns:

### Listing Information (8 columns)

- Title
- Description
- SKU
- Status
- Quantity
- Tags
- Price
- Currency Code

### Variation Properties (4 columns)

- Property Name 1
- Property Option 1
- Property Name 2
- Property Option 2

### Variation Details (4 columns)

- Property SKU
- Property Quantity
- Property Price
- Property Is Enabled

### Variation Property IDs (5 columns)

- Property Product ID
- Property ID 1
- Property Option IDs 1
- Property ID 2
- Property Option IDs 2

### Identifiers (2 columns)

- Product ID
- Listing ID

**Important:** When editing the CSV:

- Keep the **Listing ID** and **Product ID** columns intact - these are used to identify which listings to update
- To create a new listing, leave the **Listing ID** column empty
- To delete a listing, set the **SKU** column to "DELETE"
- To delete a variation, set the **Property SKU** column to "DELETE"

## Etsy API Setup

To use this extension, you need to create an Etsy app:

1. Go to [Etsy Developers](https://www.etsy.com/developers)
2. Sign in with your Etsy account
3. Click **"Register a new application"**
4. Fill in the application details:
   - **Application name**: Clipsy Dashboard (or your preferred name)
   - **Application website**: Your website (optional)
   - **Application description**: Bulk edit Etsy listings with CSV
5. After creating the app, you'll see your **Client ID** (also called "Keystring")
6. Copy the Client ID and replace the hardcoded value in:
   - `src/services/oauth.ts` (in the `getClientID()` function)
   - `src/services/etsyApi.ts` (in the `getClientID()` function)
7. **Register the redirect URL** in your Etsy app settings:
   - After building the extension, load it in Chrome
   - Open the browser console (F12) and check the logs - it will show your redirect URL
   - The redirect URL will be in the format: `https://<extension-id>.chromiumapp.org/`
   - Go to your Etsy app settings and add this exact URL to the "Redirect URI" field
   - **Important**: The URL must match exactly, including the trailing slash

### Required Scopes

Make sure your Etsy app has the following scopes enabled:

- `listings_r` - Read listings
- `listings_w` - Write listings
- `shops_r` - Read shop information

These scopes are typically enabled by default for new apps.

## Deployment

### Automated Deployment to Chrome Web Store

The project includes a GitHub Actions workflow for automated deployment to the Chrome Web Store.

#### Setup

1. **Get Chrome Web Store API credentials:**

   - Go to [Google Cloud Console](https://console.cloud.google.com/)
   - Create a new project or select an existing one
   - Enable the "Chrome Web Store API"
   - Go to "Credentials" ‚Üí "Create Credentials" ‚Üí "OAuth client ID"
   - Choose "Web application"
   - Add authorized redirect URI: `https://www.googleapis.com/auth/chromewebstore`
   - Copy the **Client ID** and **Client Secret**

2. **Get a refresh token:**

   You can use the [Chrome Web Store API Node.js sample](https://github.com/googlesamples/chrome-webstore-samples) or use a tool like [chrome-webstore-upload](https://www.npmjs.com/package/chrome-webstore-upload) to generate a refresh token.

   Alternatively, use this quick method:
   ```bash
   npm install -g chrome-webstore-upload-cli
   chrome-webstore-upload --help
   ```

3. **Get your Extension ID:**

   - Load your extension in Chrome
   - Go to `chrome://extensions/`
   - Find your extension and copy the ID (long string under the extension name)

4. **Add GitHub Secrets:**

   Go to your GitHub repository ‚Üí Settings ‚Üí Secrets and variables ‚Üí Actions, and add:

   - `CHROME_EXTENSION_ID` - Your Chrome extension ID
   - `CHROME_CLIENT_ID` - OAuth Client ID from Google Cloud Console
   - `CHROME_CLIENT_SECRET` - OAuth Client Secret from Google Cloud Console
   - `CHROME_REFRESH_TOKEN` - OAuth Refresh Token

#### Deploying

**Option 1: Tag-based deployment (recommended)**

Create a version tag and push it:

```bash
git tag v1.0.0
git push origin v1.0.0
```

The workflow will automatically:
- Build the extension
- Create a zip file
- Upload to Chrome Web Store (submitted for review, not auto-published)

**Option 2: Manual deployment**

1. Go to your GitHub repository
2. Click "Actions" tab
3. Select "Deploy to Chrome Web Store" workflow
4. Click "Run workflow"
5. Select the branch and click "Run workflow"

#### Publishing

By default, the workflow submits the extension for review but doesn't auto-publish. To auto-publish:

1. Edit `.github/workflows/deploy.yml`
2. Change `publish: false` to `publish: true`

**Note:** Auto-publishing will immediately publish the extension without review. Use with caution.

## License

[Add your license here]

## Support

For issues or questions, please [open an issue](link-to-issues) or contact [your contact info].
